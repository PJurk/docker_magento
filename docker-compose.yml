version: '3.0'
services:
  magento:
    build: 
      context: ./
    container_name: my-magento
    image: pjurk/magento2-test
    ports:
      - "80:80"
    links:
      - db
      #- chrome
    volumes: 
      - ./app:/var/www/html  
    env_file:
      - env
  db:
    image: mysql:latest
    volumes:
      - ./db:/var/lib/mysql
    env_file:
      - env
    command: --innodb_use_native_aio=0
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin
    ports:
      - "8580:80"
    links:
      - db  
  # chrome:
  #   image: selenium/standalone-chrome:3.141.59
  #   container_name: chrome
  #   ports:
  #     - "5900:5900"
  #   volumes:
  #     - /dev/shm:/dev/shm
  # allure:
  #   image: frankescobar/allure-docker-service
  #   container_name: magento_allure
  #   environment:
  #     CHECK_RESULTS_EVERY_SECONDS: 1
  #     KEEP_HISTORY: "TRUE"
  #   ports:
  #     - "4040:4040"
  #     - "5050:5050"
  #   volumes:
  #     - ./app/dev/tests/acceptance/tests/_output/allure-results:/app/allure-results